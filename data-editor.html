<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡‘è‡³æŠ•èµ„æ•°æ®ç¼–è¾‘å™¨</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        /* ===== å…¨å±€æ ·å¼ ===== */
        :root {
            /* ä¸“ä¸šé‡‘èé…è‰²æ–¹æ¡ˆ */
            --primary-dark: #0a1f44;
            --primary: #1a3e72;
            --secondary: #3d5a80;
            --accent: #00b4d8;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
            --border: rgba(0,0,0,0.08);
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.08);
            --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background-color: var(--light);
            color: var(--dark);
            line-height: 1.6;
            min-width: 1200px;
        }

        /* ===== å¤´éƒ¨æ ·å¼ ===== */
        header {
            background: rgba(255, 255, 255, 0.98);
            color: var(--primary-dark);
            padding: 1rem 2rem;
            height: 60px;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            box-shadow: 0 1px 10px rgba(0,0,0,0.05);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 100%;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: 600;
            font-family: 'Roboto', sans-serif;
            letter-spacing: 1px;
            color: var(--primary-dark);
        }
        
        .logo span {
            font-weight: 700;
            color: var(--primary);
        }



        /* ===== æ“ä½œæŒ‰é’®åŒºåŸŸ ===== */
        .action-bar {
            background: white;
            border-radius: var(--radius-md);
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-sm);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* ===== æ•°æ®ç‰ˆå—ç¼–è¾‘åŒºåŸŸ ===== */
        .metrics-editor {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .metric-editor-card {
            background: white;
            border-radius: var(--radius-md);
            padding: 2rem;
            box-shadow: var(--shadow-sm);
        }

        .metric-header {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
            color: var(--primary-dark);
        }

        .metric-icon {
            font-size: 1.5rem;
            margin-right: 1rem;
        }

        .metric-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            font-size: 0.9rem;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(0, 180, 216, 0.1);
        }

        .input-group {
            display: flex;
            gap: 1rem;
        }

        .input-group .form-group {
            flex: 1;
        }

        /* ===== å›¾è¡¨æ•°æ®ç¼–è¾‘åŒºåŸŸ ===== */
        .chart-editor {
            background: white;
            border-radius: var(--radius-md);
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-sm);
        }

        .chart-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .chart-container {
            width: 100%;
            height: 400px;
            margin-bottom: 2rem;
        }

        .data-table-container {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th,
        .data-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .data-table th {
            background: var(--light);
            font-weight: 600;
            color: var(--dark);
            position: sticky;
            top: 0;
        }

        .data-table input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
        }

        .table-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-small {
            padding: 0.5rem;
            font-size: 0.8rem;
        }

        /* ===== çŠ¶æ€æç¤º ===== */
        .status-message {
            position: fixed;
            top: 80px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: var(--radius-md);
            color: white;
            font-weight: 500;
            z-index: 2000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .status-success {
            background: var(--success);
        }

        .status-error {
            background: var(--danger);
        }

        .status-warning {
            background: var(--warning);
        }

        .status-show {
            transform: translateX(0);
        }

        /* ===== æ·»åŠ æŒ‰é’®å®¹å™¨ ===== */
        .add-button-container {
            text-align: center;
            margin-top: 1.5rem;
            padding: 1rem;
            background: var(--light);
            border-radius: var(--radius-md);
            border: 2px dashed var(--border);
            transition: all 0.3s ease;
        }

        .add-button-container:hover {
            border-color: var(--accent);
            background: white;
        }

        .add-button-container .btn {
            padding: 1rem 2rem;
            font-size: 1rem;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border: none;
            transform: translateY(0);
            transition: all 0.3s ease;
        }

        .add-button-container .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(26, 62, 114, 0.3);
        }

        /* ===== åº•éƒ¨æ“ä½œæ  ===== */
        .bottom-action-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            box-shadow: 0 -2px 20px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            border-top: 1px solid var(--border);
        }

        .action-bar-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .left-buttons, .right-buttons {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 80px 2rem 120px 2rem; /* å¢åŠ åº•éƒ¨paddingä¸ºåº•éƒ¨æŒ‰é’®æ ç•™ç©ºé—´ */
        }

        /* ===== å“åº”å¼å¸ƒå±€ ===== */
        @media screen and (max-width: 1200px) {
            .metrics-editor {
                grid-template-columns: 1fr;
            }
            
            .action-bar-content {
                justify-content: center;
            }
            
            .left-buttons, .right-buttons {
                justify-content: center;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">
                é‡‘è‡³<span>æŠ•èµ„</span>æ•°æ®ç¼–è¾‘å™¨
            </div>
            <div>
                <a href="index.html" class="btn btn-primary">
                    <i class="fas fa-home"></i>
                    è¿”å›ä¸»é¡µ
                </a>
            </div>
        </div>
    </header>

    <div class="main-container">
        <!-- æ•°æ®ç‰ˆå—ç¼–è¾‘ -->
        <section class="metrics-editor">
            <!-- æ€»èµ„äº§ç®¡ç†è§„æ¨¡ -->
            <div class="metric-editor-card">
                <div class="metric-header">
                    <span class="metric-icon">ğŸ’°</span>
                    <h3 class="metric-title">æ€»èµ„äº§ç®¡ç†è§„æ¨¡</h3>
                </div>
                <div class="form-group">
                    <label class="form-label">å½“å‰æ•°å€¼ (Â¥)</label>
                    <input type="number" class="form-control" id="aum-value" min="0" step="0.01">
                </div>
                <div class="input-group">
                <div class="form-group">
                    <label class="form-label">å˜åŒ–ç‡ (%)</label>
                    <input type="number" class="form-control" id="aum-change" step="0.01">
                </div>
                    <div class="form-group">
                        <label class="form-label">å˜åŒ–ç±»å‹</label>
                        <select class="form-control" id="aum-change-type">
                            <option value="positive">ä¸Šå‡</option>
                            <option value="negative">ä¸‹é™</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- èèµ„æ€»é¢ -->
            <div class="metric-editor-card">
                <div class="metric-header">
                    <span class="metric-icon">ğŸ¦</span>
                    <h3 class="metric-title">èèµ„æ€»é¢</h3>
                </div>
                <div class="form-group">
                    <label class="form-label">å½“å‰æ•°å€¼ (Â¥)</label>
                    <input type="number" class="form-control" id="financing-value" min="0" step="0.01">
                </div>
                <div class="input-group">
                <div class="form-group">
                    <label class="form-label">å˜åŒ–ç‡ (%)</label>
                    <input type="number" class="form-control" id="financing-change" step="0.01">
                </div>
                    <div class="form-group">
                        <label class="form-label">å˜åŒ–ç±»å‹</label>
                        <select class="form-control" id="financing-change-type">
                            <option value="positive">ä¸Šå‡</option>
                            <option value="negative">ä¸‹é™</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- èµ„æœ¬æ€»é¢ -->
            <div class="metric-editor-card">
                <div class="metric-header">
                    <span class="metric-icon">ğŸ’¼</span>
                    <h3 class="metric-title">èµ„æœ¬æ€»é¢</h3>
                </div>
                <div class="form-group">
                    <label class="form-label">å½“å‰æ•°å€¼ (Â¥)</label>
                    <input type="number" class="form-control" id="capital-value" min="0" step="0.01">
                </div>
                <div class="input-group">
                <div class="form-group">
                    <label class="form-label">å˜åŒ–ç‡ (%)</label>
                    <input type="number" class="form-control" id="capital-change" step="0.01">
                </div>
                    <div class="form-group">
                        <label class="form-label">å˜åŒ–ç±»å‹</label>
                        <select class="form-control" id="capital-change-type">
                            <option value="positive">ä¸Šå‡</option>
                            <option value="negative">ä¸‹é™</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- å®¢æˆ·æ•°é‡ -->
            <div class="metric-editor-card">
                <div class="metric-header">
                    <span class="metric-icon">ğŸ‘¥</span>
                    <h3 class="metric-title">å®¢æˆ·æ•°é‡</h3>
                </div>
                <div class="form-group">
                    <label class="form-label">å½“å‰æ•°é‡</label>
                    <input type="number" class="form-control" id="clients-value" min="0" step="0.01">
                </div>
                <div class="input-group">
                    <div class="form-group">
                        <label class="form-label">å˜åŒ–æ•°é‡</label>
                        <input type="number" class="form-control" id="clients-change" step="0.01">
                    </div>
                    <div class="form-group">
                        <label class="form-label">å˜åŒ–ç±»å‹</label>
                        <select class="form-control" id="clients-change-type">
                            <option value="positive">å¢åŠ </option>
                            <option value="negative">å‡å°‘</option>
                        </select>
                    </div>
                </div>
            </div>
        </section>

        <!-- å›¾è¡¨æ•°æ®ç¼–è¾‘ -->
        <section class="chart-editor">
            <div class="chart-controls">
                <h2>è¶‹åŠ¿å›¾è¡¨æ•°æ®ç¼–è¾‘</h2>
            </div>

            <div class="chart-container" id="chartPreview"></div>

            <div class="data-table-container">
                <table class="data-table" id="chartDataTable">
                    <thead>
                        <tr>
                            <th>æ—¥æœŸ (å¹´-æœˆ-æ—¥)</th>
                            <th>èèµ„æ€»é¢ (Â¥)</th>
                            <th>èµ„æœ¬æ€»é¢ (Â¥)</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="chartDataBody">
                        <!-- æ•°æ®è¡Œå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </tbody>
                </table>
            </div>

            <div class="add-button-container" style="text-align: center; margin-top: 1.5rem;">
                <button class="btn btn-primary" onclick="addChartDataPoint()">
                    <i class="fas fa-plus"></i>
                    æ·»åŠ æ•°æ®ç‚¹
                </button>
            </div>
        </section>

        <!-- åº•éƒ¨æ“ä½œæŒ‰é’®æ  -->
        <div class="bottom-action-bar">
            <div class="action-bar-content">
                <div class="left-buttons">
                    <button class="btn btn-success" onclick="saveAllData()">
                        <i class="fas fa-save"></i>
                        ä¿å­˜æ‰€æœ‰æ•°æ®
                    </button>
                    <button class="btn btn-primary" onclick="updateToMainPage()">
                        <i class="fas fa-sync-alt"></i>
                        æ›´æ–°åˆ°ä¸»é¡µ
                    </button>
                </div>
                <div class="right-buttons">
                    <button class="btn btn-primary" onclick="exportData()">
                        <i class="fas fa-download"></i>
                        å¯¼å‡ºæ•°æ®
                    </button>
                    <button class="btn btn-primary" onclick="importData()">
                        <i class="fas fa-upload"></i>
                        å¯¼å…¥æ•°æ®
                    </button>
                    <input type="file" id="import-file" accept=".json" style="display: none;" onchange="handleImport(event)">
                </div>
            </div>
        </div>
    </div>

    <!-- çŠ¶æ€æç¤º -->
    <div id="statusMessage" class="status-message"></div>

    <script>
        // åˆå§‹åŒ–å›¾è¡¨æ•°æ® - å°†åœ¨loadSavedDataä¸­ä»localStorageåŠ è½½
        let chartData = [];

        let chart = null;

        // æµ‹è¯•localStorageæ˜¯å¦å¯ç”¨
        function testLocalStorage() {
            try {
                const testKey = 'test-jinzhi-storage';
                localStorage.setItem(testKey, 'test-value');
                const testValue = localStorage.getItem(testKey);
                localStorage.removeItem(testKey);
                if (testValue === 'test-value') {
                    console.log('localStorageæµ‹è¯•é€šè¿‡');
                    return true;
                } else {
                    console.error('localStorageæµ‹è¯•å¤±è´¥ï¼šè¯»å†™ä¸ä¸€è‡´');
                    return false;
                }
            } catch (error) {
                console.error('localStorageä¸å¯ç”¨:', error);
                return false;
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('é¡µé¢å¼€å§‹åŠ è½½...');
            
            // æµ‹è¯•localStorage
            if (!testLocalStorage()) {
                showStatus('localStorageä¸å¯ç”¨ï¼Œæ•°æ®æ— æ³•ä¿å­˜ï¼', 'error');
                return;
            }
            
            await loadSavedData();
            initChart();
            updateDataTable();
            
            // ä¸ºæ‰€æœ‰è¾“å…¥æ¡†æ·»åŠ å˜åŒ–ç›‘å¬ï¼Œå®æ—¶ä¿å­˜
            const inputs = document.querySelectorAll('input[type="number"], input[type="date"], select');
            console.log('æ‰¾åˆ°è¾“å…¥æ¡†æ•°é‡:', inputs.length);
            inputs.forEach(input => {
                input.addEventListener('change', function() {
                    console.log('æ£€æµ‹åˆ°è¾“å…¥å˜åŒ–ï¼Œè‡ªåŠ¨ä¿å­˜');
                    saveAllData();
                });
            });
            
            // ç›‘å¬å›¾è¡¨æ•°æ®å˜åŒ–
            const chartInputs = document.querySelectorAll('#chartDataBody input');
            chartInputs.forEach(input => {
                input.addEventListener('input', function() {
                    console.log('æ£€æµ‹åˆ°å›¾è¡¨æ•°æ®å˜åŒ–');
                });
            });
            
            // å®šæœŸè‡ªåŠ¨ä¿å­˜ï¼ˆæ¯30ç§’ï¼‰
            setInterval(() => {
                console.log('å®šæœŸè‡ªåŠ¨ä¿å­˜');
                saveAllData();
            }, 30000);
            
            console.log('é¡µé¢åˆå§‹åŒ–å®Œæˆ');
        });

        // åŠ è½½ä¿å­˜çš„æ•°æ® - ä¼˜å…ˆä»localStorageè¯»å–ï¼Œæ²¡æœ‰æ‰ä½¿ç”¨é»˜è®¤å€¼
        async function loadSavedData() {
            console.log('æ•°æ®ç¼–è¾‘å™¨ï¼šå¼€å§‹åŠ è½½æ•°æ®');
            console.log('localStorageæ£€æŸ¥ - jinzhi-metrics:', localStorage.getItem('jinzhi-metrics'));
            console.log('localStorageæ£€æŸ¥ - jinzhi-chart-data:', localStorage.getItem('jinzhi-chart-data'));
            
            // ä¼˜å…ˆä»localStorageè¯»å–æŒ‡æ ‡æ•°æ®
            const savedMetrics = localStorage.getItem('jinzhi-metrics');
            if (savedMetrics) {
                try {
                    const data = JSON.parse(savedMetrics);
                    console.log('æ•°æ®ç¼–è¾‘å™¨ï¼šä½¿ç”¨æœ¬åœ°ä¿å­˜çš„æŒ‡æ ‡æ•°æ®', data);
                    
                    // æ¢å¤æŒ‡æ ‡æ•°æ® - ä½¿ç”¨setTimeoutç¡®ä¿DOMå®Œå…¨åŠ è½½
                    setTimeout(() => {
                        const aumValue = document.getElementById('aum-value');
                        const aumChange = document.getElementById('aum-change');
                        const aumChangeType = document.getElementById('aum-change-type');
                        
                        const financingValue = document.getElementById('financing-value');
                        const financingChange = document.getElementById('financing-change');
                        const financingChangeType = document.getElementById('financing-change-type');
                        
                        const capitalValue = document.getElementById('capital-value');
                        const capitalChange = document.getElementById('capital-change');
                        const capitalChangeType = document.getElementById('capital-change-type');
                        
                        const clientsValue = document.getElementById('clients-value');
                        const clientsChange = document.getElementById('clients-change');
                        const clientsChangeType = document.getElementById('clients-change-type');
                        
                        if (aumValue) aumValue.value = data.aum || 206695;
                        if (aumChange) aumChange.value = (data.aumChange || 5.2).toFixed(2);
                        if (aumChangeType) aumChangeType.value = data.aumChangeType || 'positive';
                        
                        if (financingValue) financingValue.value = data.financing || 134160;
                        if (financingChange) financingChange.value = (data.financingChange || 3.1).toFixed(2);
                        if (financingChangeType) financingChangeType.value = data.financingChangeType || 'positive';
                        
                        if (capitalValue) capitalValue.value = data.capital || 1000;
                        if (capitalChange) capitalChange.value = (data.capitalChange || 2.8).toFixed(2);
                        if (capitalChangeType) capitalChangeType.value = data.capitalChangeType || 'positive';
                        
                        if (clientsValue) clientsValue.value = data.clients || 9;
                        if (clientsChange) clientsChange.value = data.clientsChange || 12;
                        if (clientsChangeType) clientsChangeType.value = data.clientsChangeType || 'positive';
                        
                        console.log('è¡¨å•æ•°æ®å·²æ¢å¤');
                    }, 100);
                    
                    console.log('æŒ‡æ ‡æ•°æ®å·²æ¢å¤åˆ°è¡¨å•');
                } catch (e) {
                    console.error('æ•°æ®ç¼–è¾‘å™¨ï¼šåŠ è½½æœ¬åœ°ä¿å­˜çš„æŒ‡æ ‡æ•°æ®å¤±è´¥:', e);
                }
            } else {
                console.log('æ•°æ®ç¼–è¾‘å™¨ï¼šæ²¡æœ‰æœ¬åœ°ä¿å­˜çš„æŒ‡æ ‡æ•°æ®ï¼Œä½¿ç”¨é»˜è®¤å€¼');
            }

            // ä»localStorageè¯»å–å›¾è¡¨æ•°æ®
            const savedChartData = localStorage.getItem('jinzhi-chart-data');
            if (savedChartData) {
                try {
                    chartData = JSON.parse(savedChartData);
                    console.log('æ•°æ®ç¼–è¾‘å™¨ï¼šä½¿ç”¨æœ¬åœ°ä¿å­˜çš„å›¾è¡¨æ•°æ®', chartData.length, 'æ¡è®°å½•');
                } catch (e) {
                    console.error('æ•°æ®ç¼–è¾‘å™¨ï¼šåŠ è½½æœ¬åœ°å›¾è¡¨æ•°æ®å¤±è´¥:', e);
                    // ä½¿ç”¨é»˜è®¤æ•°æ®
                    chartData = [
                        { date: '2020-01-28', financing: 10750, capital: 9376 },
                        { date: '2020-08-25', financing: 22600, capital: 235 },
                        { date: '2023-03-01', financing: 43029, capital: 708 },
                        { date: '2024-12-01', financing: 70129, capital: 32176 },
                        { date: '2025-03-01', financing: 145515, capital: 157399 },
                        { date: '2025-04-01', financing: 126792, capital: 628218 },
                        { date: '2025-11-29', financing: 134160, capital: 1000 },
                        { date: '2025-12-10', financing: 206695, capital: -5000 }
                    ];
                }
            } else {
                console.log('æ•°æ®ç¼–è¾‘å™¨ï¼šæ²¡æœ‰æœ¬åœ°ä¿å­˜çš„å›¾è¡¨æ•°æ®ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®');
                // ä½¿ç”¨é»˜è®¤æ•°æ®
                chartData = [
                    { date: '2020-01-28', financing: 10750, capital: 9376 },
                    { date: '2020-08-25', financing: 22600, capital: 235 },
                    { date: '2023-03-01', financing: 43029, capital: 708 },
                    { date: '2024-12-01', financing: 70129, capital: 32176 },
                    { date: '2025-03-01', financing: 145515, capital: 157399 },
                    { date: '2025-04-01', financing: 126792, capital: 628218 },
                    { date: '2025-11-29', financing: 134160, capital: 1000 },
                    { date: '2025-12-10', financing: 206695, capital: -5000 }
                ];
            }
            
            console.log('æ•°æ®åŠ è½½å®Œæˆ');
        }

        // åˆå§‹åŒ–å›¾è¡¨
        function initChart() {
            const chartDom = document.getElementById('chartPreview');
            if (!chartDom) return;
            
            chart = echarts.init(chartDom);
            
            const option = {
                title: {
                    text: 'èèµ„æ€»é¢å’Œèµ„æœ¬æ€»é¢è¶‹åŠ¿é¢„è§ˆ',
                    left: 'center',
                    textStyle: {
                        color: '#1a3e72',
                        fontSize: 16
                    }
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross'
                    },
                    formatter: function(params) {
                        let result = params[0].name + '<br/>';
                        params.forEach(item => {
                            result += `${item.marker} ${item.seriesName}: Â¥${item.value.toLocaleString()}<br/>`;
                        });
                        return result;
                    }
                },
                legend: {
                    data: ['èèµ„æ€»é¢', 'èµ„æœ¬æ€»é¢'],
                    bottom: 10
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '15%',
                    top: '15%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: chartData.map(item => item.date)
                },
                yAxis: {
                    type: 'value',
                    axisLabel: {
                        formatter: 'Â¥{value}'
                    }
                },
                series: [
                    {
                        name: 'èèµ„æ€»é¢',
                        type: 'line',
                        data: chartData.map(item => item.financing),
                        smooth: true,
                        lineStyle: {
                            width: 3,
                            color: '#1a73e8'
                        },
                        itemStyle: {
                            color: '#1a73e8'
                        }
                    },
                    {
                        name: 'èµ„æœ¬æ€»é¢',
                        type: 'line',
                        data: chartData.map(item => item.capital),
                        smooth: true,
                        lineStyle: {
                            width: 3,
                            color: '#00b4d8'
                        },
                        itemStyle: {
                            color: '#00b4d8'
                        }
                    }
                ]
            };
            
            chart.setOption(option);
            
            window.addEventListener('resize', function() {
                if (chart) chart.resize();
            });
        }

        // æ›´æ–°å›¾è¡¨
        function updateChart() {
            if (!chart) return;
            
            chart.setOption({
                xAxis: {
                    data: chartData.map(item => item.date)
                },
                series: [
                    {
                        data: chartData.map(item => item.financing)
                    },
                    {
                        data: chartData.map(item => item.capital)
                    }
                ]
            });
        }

        // æ›´æ–°æ•°æ®è¡¨æ ¼
        function updateDataTable() {
            const tbody = document.getElementById('chartDataBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            chartData.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="date" value="${item.date}" onchange="updateChartDataPoint(${index}, 'date', this.value)"></td>
                    <td><input type="number" value="${item.financing}" min="0" onchange="updateChartDataPoint(${index}, 'financing', this.value)"></td>
                    <td><input type="number" value="${item.capital}" min="0" onchange="updateChartDataPoint(${index}, 'capital', this.value)"></td>
                    <td>
                        <div class="table-actions">
                            <button class="btn btn-danger btn-small" onclick="deleteChartDataPoint(${index})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // æ·»åŠ å›¾è¡¨æ•°æ®ç‚¹
        function addChartDataPoint() {
            // è·å–å½“å‰æ—¥æœŸï¼Œæ ¼å¼ä¸º YYYY-MM-DD
            const today = new Date();
            const todayStr = today.toISOString().slice(0, 10);
            
            chartData.push({
                date: todayStr,
                financing: 200000,
                capital: 100000
            });
            
            updateChart();
            updateDataTable();
            showStatus('å·²æ·»åŠ æ–°æ•°æ®ç‚¹', 'success');
        }

        // æ›´æ–°å›¾è¡¨æ•°æ®ç‚¹
        function updateChartDataPoint(index, field, value) {
            if (field === 'date') {
                chartData[index].date = value;
            } else if (field === 'financing') {
                chartData[index].financing = parseInt(value) || 0;
            } else if (field === 'capital') {
                chartData[index].capital = parseInt(value) || 0;
            }
            
            updateChart();
        }

        // åˆ é™¤å›¾è¡¨æ•°æ®ç‚¹
        function deleteChartDataPoint(index) {
            if (chartData.length <= 1) {
                showStatus('è‡³å°‘éœ€è¦ä¿ç•™ä¸€ä¸ªæ•°æ®ç‚¹', 'error');
                return;
            }
            
            chartData.splice(index, 1);
            updateChart();
            updateDataTable();
            showStatus('æ•°æ®ç‚¹å·²åˆ é™¤', 'success');
        }

        // ä¿å­˜æ‰€æœ‰æ•°æ®
        function saveAllData() {
            console.log('=== å¼€å§‹ä¿å­˜æ‰€æœ‰æ•°æ® ===');
            
            try {
                // éªŒè¯localStorageå¯ç”¨æ€§
                if (!testLocalStorage()) {
                    showStatus('localStorageä¸å¯ç”¨ï¼Œæ•°æ®æ— æ³•ä¿å­˜ï¼', 'error');
                    return;
                }
                
                // éªŒè¯æ‰€æœ‰å¿…éœ€çš„å…ƒç´ æ˜¯å¦å­˜åœ¨
                const elements = [
                    'aum-value', 'aum-change', 'aum-change-type',
                    'financing-value', 'financing-change', 'financing-change-type',
                    'capital-value', 'capital-change', 'capital-change-type',
                    'clients-value', 'clients-change', 'clients-change-type'
                ];
                
                console.log('éªŒè¯DOMå…ƒç´ ...');
                for (let id of elements) {
                    const element = document.getElementById(id);
                    if (!element) {
                        console.error(`æ‰¾ä¸åˆ°å…ƒç´ : ${id}`);
                        showStatus(`ä¿å­˜å¤±è´¥ï¼šæ‰¾ä¸åˆ°å…ƒç´  ${id}`, 'error');
                        return;
                    }
                    console.log(`âœ“ æ‰¾åˆ°å…ƒç´ : ${id}, å€¼: ${element.value}`);
                }
                
                console.log('æ‰€æœ‰å…ƒç´ éªŒè¯é€šè¿‡ï¼Œå¼€å§‹æ”¶é›†æ•°æ®...');
                
                // æ”¶é›†æŒ‡æ ‡æ•°æ®
                const metricsData = {
                    aum: parseInt(document.getElementById('aum-value').value) || 0,
                    aumChange: parseFloat(document.getElementById('aum-change').value) || 0,
                    aumChangeType: document.getElementById('aum-change-type').value,
                    
                    financing: parseInt(document.getElementById('financing-value').value) || 0,
                    financingChange: parseFloat(document.getElementById('financing-change').value) || 0,
                    financingChangeType: document.getElementById('financing-change-type').value,
                    
                    capital: parseInt(document.getElementById('capital-value').value) || 0,
                    capitalChange: parseFloat(document.getElementById('capital-change').value) || 0,
                    capitalChangeType: document.getElementById('capital-change-type').value,
                    
                    clients: parseInt(document.getElementById('clients-value').value) || 0,
                    clientsChange: parseInt(document.getElementById('clients-change').value) || 0,
                    clientsChangeType: document.getElementById('clients-change-type').value
                };
                
                console.log('æ”¶é›†åˆ°çš„æŒ‡æ ‡æ•°æ®:', metricsData);
                console.log('å›¾è¡¨æ•°æ®:', chartData);
                
                // æ¸…é™¤æ—§æ•°æ®
                localStorage.removeItem('jinzhi-metrics');
                localStorage.removeItem('jinzhi-chart-data');
                console.log('å·²æ¸…é™¤æ—§æ•°æ®');
                
                // ä¿å­˜åˆ°localStorage
                const metricsString = JSON.stringify(metricsData);
                const chartString = JSON.stringify(chartData);
                
                localStorage.setItem('jinzhi-metrics', metricsString);
                localStorage.setItem('jinzhi-chart-data', chartString);
                
                console.log('æ•°æ®å·²å†™å…¥localStorage');
                console.log('metricsStringé•¿åº¦:', metricsString.length);
                console.log('chartStringé•¿åº¦:', chartString.length);
                
                // ç«‹å³éªŒè¯ä¿å­˜æ˜¯å¦æˆåŠŸ
                const savedMetrics = localStorage.getItem('jinzhi-metrics');
                const savedChart = localStorage.getItem('jinzhi-chart-data');
                
                console.log('ä¿å­˜åéªŒè¯ - æŒ‡æ ‡æ•°æ®å­˜åœ¨:', !!savedMetrics);
                console.log('ä¿å­˜åéªŒè¯ - å›¾è¡¨æ•°æ®å­˜åœ¨:', !!savedChart);
                console.log('ä¿å­˜åéªŒè¯ - æŒ‡æ ‡æ•°æ®å†…å®¹:', savedMetrics);
                console.log('ä¿å­˜åéªŒè¯ - å›¾è¡¨æ•°æ®å†…å®¹:', savedChart);
                
                if (savedMetrics && savedChart && savedMetrics.length > 0 && savedChart.length > 0) {
                    console.log('âœ“ æ•°æ®ä¿å­˜æˆåŠŸï¼localStorageå·²æ›´æ–°');
                    showStatus('æ‰€æœ‰æ•°æ®å·²ä¿å­˜æˆåŠŸï¼', 'success');
                    
                    // 5ç§’åå†æ¬¡éªŒè¯
                    setTimeout(() => {
                        const verifyMetrics = localStorage.getItem('jinzhi-metrics');
                        const verifyChart = localStorage.getItem('jinzhi-chart-data');
                        console.log('5ç§’åéªŒè¯ - æŒ‡æ ‡æ•°æ®ä»å­˜åœ¨:', !!verifyMetrics);
                        console.log('5ç§’åéªŒè¯ - å›¾è¡¨æ•°æ®ä»å­˜åœ¨:', !!verifyChart);
                    }, 5000);
                    
                } else {
                    console.error('âœ— æ•°æ®ä¿å­˜å¤±è´¥');
                    showStatus('æ•°æ®ä¿å­˜å¤±è´¥ï¼', 'error');
                }
                
            } catch (error) {
                console.error('ä¿å­˜æ•°æ®æ—¶å‘ç”Ÿé”™è¯¯:', error);
                showStatus(`ä¿å­˜å¤±è´¥ï¼š${error.message}`, 'error');
            }
            
            console.log('=== ä¿å­˜æ“ä½œç»“æŸ ===');
        }

        // å¼ºåˆ¶ä¿å­˜æ•°æ®ï¼ˆæ›´æ¿€è¿›çš„ä¿å­˜æ–¹å¼ï¼‰
        function forceSaveData() {
            console.log('=== å¼ºåˆ¶ä¿å­˜å¼€å§‹ ===');
            
            try {
                // æ¸…é™¤å¯èƒ½å­˜åœ¨çš„æ—§æ•°æ®
                localStorage.removeItem('jinzhi-metrics');
                localStorage.removeItem('jinzhi-chart-data');
                
                // æ”¶é›†å½“å‰æ‰€æœ‰æ•°æ®
                const metricsData = {
                    aum: parseInt(document.getElementById('aum-value').value) || 0,
                    aumChange: parseFloat(document.getElementById('aum-change').value) || 0,
                    aumChangeType: document.getElementById('aum-change-type').value,
                    
                    financing: parseInt(document.getElementById('financing-value').value) || 0,
                    financingChange: parseFloat(document.getElementById('financing-change').value) || 0,
                    financingChangeType: document.getElementById('financing-change-type').value,
                    
                    capital: parseInt(document.getElementById('capital-value').value) || 0,
                    capitalChange: parseFloat(document.getElementById('capital-change').value) || 0,
                    capitalChangeType: document.getElementById('capital-change-type').value,
                    
                    clients: parseInt(document.getElementById('clients-value').value) || 0,
                    clientsChange: parseInt(document.getElementById('clients-change').value) || 0,
                    clientsChangeType: document.getElementById('clients-change-type').value
                };
                
                console.log('å¼ºåˆ¶ä¿å­˜ - æŒ‡æ ‡æ•°æ®:', metricsData);
                console.log('å¼ºåˆ¶ä¿å­˜ - å›¾è¡¨æ•°æ®:', chartData);
                
                // å¤šæ¬¡å°è¯•ä¿å­˜
                for (let i = 0; i < 3; i++) {
                    localStorage.setItem('jinzhi-metrics', JSON.stringify(metricsData));
                    localStorage.setItem('jinzhi-chart-data', JSON.stringify(chartData));
                    
                    // éªŒè¯
                    const savedMetrics = localStorage.getItem('jinzhi-metrics');
                    const savedChart = localStorage.getItem('jinzhi-chart-data');
                    
                    if (savedMetrics && savedChart) {
                        console.log(`å¼ºåˆ¶ä¿å­˜æˆåŠŸï¼ˆç¬¬${i+1}æ¬¡å°è¯•ï¼‰`);
                        showStatus(`æ•°æ®å¼ºåˆ¶ä¿å­˜æˆåŠŸï¼`, 'success');
                        
                        // ç«‹å³éªŒè¯æ¢å¤
                        console.log('ç«‹å³éªŒè¯æ•°æ®æ¢å¤...');
                        setTimeout(() => {
                            const verifyMetrics = localStorage.getItem('jinzhi-metrics');
                            const verifyChart = localStorage.getItem('jinzhi-chart-data');
                            console.log('éªŒè¯ - æŒ‡æ ‡æ•°æ®å­˜åœ¨:', !!verifyMetrics);
                            console.log('éªŒè¯ - å›¾è¡¨æ•°æ®å­˜åœ¨:', !!verifyChart);
                        }, 100);
                        return;
                    } else {
                        console.error(`å¼ºåˆ¶ä¿å­˜å¤±è´¥ï¼ˆç¬¬${i+1}æ¬¡å°è¯•ï¼‰`);
                    }
                }
                
                showStatus('å¼ºåˆ¶ä¿å­˜å¤±è´¥ï¼', 'error');
            } catch (error) {
                console.error('å¼ºåˆ¶ä¿å­˜æ—¶å‘ç”Ÿé”™è¯¯:', error);
                showStatus(`å¼ºåˆ¶ä¿å­˜å¤±è´¥ï¼š${error.message}`, 'error');
            }
            
            console.log('=== å¼ºåˆ¶ä¿å­˜ç»“æŸ ===');
        }

        // æ›´æ–°åˆ°ä¸»é¡µ
        function updateToMainPage() {
            saveAllData();
            localStorage.setItem('jinzhi-needs-refresh', 'true');
            localStorage.setItem('jinzhi-last-update', new Date().toISOString());
            showStatus('æ•°æ®å·²æ›´æ–°åˆ°ä¸»é¡µï¼æ­£åœ¨è·³è½¬...', 'success');
            setTimeout(() => {
                window.open('index.html', '_blank');
            }, 1000);
        }
        


        
        
        

        

        // å¯¼å‡ºæ•°æ®
        function exportData() {
            const data = {
                metrics: {
                    aum: {
                        value: parseInt(document.getElementById('aum-value').value) || 0,
                        change: parseFloat(document.getElementById('aum-change').value) || 0,
                        changeType: document.getElementById('aum-change-type').value
                    },
                    financing: {
                        value: parseInt(document.getElementById('financing-value').value) || 0,
                        change: parseFloat(document.getElementById('financing-change').value) || 0,
                        changeType: document.getElementById('financing-change-type').value
                    },
                    capital: {
                        value: parseInt(document.getElementById('capital-value').value) || 0,
                        change: parseFloat(document.getElementById('capital-change').value) || 0,
                        changeType: document.getElementById('capital-change-type').value
                    },
                    clients: {
                        value: parseInt(document.getElementById('clients-value').value) || 0,
                        change: parseInt(document.getElementById('clients-change').value) || 0,
                        changeType: document.getElementById('clients-change-type').value
                    }
                },
                chartData: chartData
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `jinzhi-data-${new Date().toISOString().slice(0, 10)}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showStatus('æ•°æ®å·²å¯¼å‡º', 'success');
        }

        // æ£€æŸ¥localStorageçŠ¶æ€
        function checkLocalStorageStatus() {
            console.log('=== localStorageçŠ¶æ€æ£€æŸ¥ ===');
            
            // æ£€æŸ¥åŸºæœ¬å­˜å‚¨èƒ½åŠ›
            console.log('localStorageå¯ç”¨æ€§:', typeof(Storage) !== "undefined");
            console.log('localStorageå½“å‰å¤§å°:', JSON.stringify(localStorage).length, 'å­—ç¬¦');
            
            // æ£€æŸ¥å…·ä½“æ•°æ®
            const metrics = localStorage.getItem('jinzhi-metrics');
            const chartData = localStorage.getItem('jinzhi-chart-data');
            const needsRefresh = localStorage.getItem('jinzhi-needs-refresh');
            const lastUpdate = localStorage.getItem('jinzhi-last-update');
            
            console.log('jinzhi-metricså­˜åœ¨:', !!metrics);
            console.log('jinzhi-chart-dataå­˜åœ¨:', !!chartData);
            console.log('jinzhi-needs-refreshå­˜åœ¨:', !!needsRefresh);
            console.log('jinzhi-last-updateå­˜åœ¨:', !!lastUpdate);
            
            if (metrics) {
                try {
                    const parsed = JSON.parse(metrics);
                    console.log('è§£æçš„æŒ‡æ ‡æ•°æ®:', parsed);
                } catch (e) {
                    console.error('æŒ‡æ ‡æ•°æ®è§£æå¤±è´¥:', e);
                }
            }
            
            if (chartData) {
                try {
                    const parsed = JSON.parse(chartData);
                    console.log('è§£æçš„å›¾è¡¨æ•°æ®:', parsed);
                } catch (e) {
                    console.error('å›¾è¡¨æ•°æ®è§£æå¤±è´¥:', e);
                }
            }
            
            // æ˜¾ç¤ºæ‰€æœ‰localStorageé”®
            console.log('æ‰€æœ‰localStorageé”®:');
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                console.log(`  ${key}: ${localStorage.getItem(key)?.substring(0, 100)}...`);
            }
            
            console.log('=== æ£€æŸ¥å®Œæˆ ===');
            
            showStatus('localStorageçŠ¶æ€å·²è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œè¯·æŒ‰F12æŸ¥çœ‹', 'success');
        }

        // å¯¼å…¥æ•°æ®
        function importData() {
            document.getElementById('import-file').click();
        }

        // å¤„ç†å¯¼å…¥æ–‡ä»¶
        function handleImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.metrics) {
                        // å¯¼å…¥æŒ‡æ ‡æ•°æ®
                        if (data.metrics.aum) {
                            document.getElementById('aum-value').value = data.metrics.aum.value || 206695;
                            document.getElementById('aum-change').value = data.metrics.aum.change || 5.2;
                            document.getElementById('aum-change-type').value = data.metrics.aum.changeType || 'positive';
                        }
                        
                        if (data.metrics.financing) {
                            document.getElementById('financing-value').value = data.metrics.financing.value || 134160;
                            document.getElementById('financing-change').value = data.metrics.financing.change || 3.1;
                            document.getElementById('financing-change-type').value = data.metrics.financing.changeType || 'positive';
                        }
                        
                        if (data.metrics.capital) {
                            document.getElementById('capital-value').value = data.metrics.capital.value || 1000;
                            document.getElementById('capital-change').value = data.metrics.capital.change || 2.8;
                            document.getElementById('capital-change-type').value = data.metrics.capital.changeType || 'positive';
                        }
                        
                        if (data.metrics.clients) {
                            document.getElementById('clients-value').value = data.metrics.clients.value || 9;
                            document.getElementById('clients-change').value = data.metrics.clients.change || 12;
                            document.getElementById('clients-change-type').value = data.metrics.clients.changeType || 'positive';
                        }
                    }
                    
                    if (data.chartData) {
                        chartData = data.chartData;
                        updateChart();
                        updateDataTable();
                    }
                    
                    showStatus('æ•°æ®å¯¼å…¥æˆåŠŸ', 'success');
                } catch (error) {
                    showStatus('æ•°æ®æ ¼å¼é”™è¯¯ï¼Œå¯¼å…¥å¤±è´¥', 'error');
                    console.error('å¯¼å…¥æ•°æ®é”™è¯¯:', error);
                }
            };
            
            reader.readAsText(file);
            event.target.value = ''; // é‡ç½®æ–‡ä»¶è¾“å…¥
        }

        

        // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
        function showStatus(message, type = 'success') {
            const statusElement = document.getElementById('statusMessage');
            statusElement.textContent = message;
            statusElement.className = `status-message status-${type} status-show`;
            
            setTimeout(() => {
                statusElement.classList.remove('status-show');
            }, 3000);
        }
    </script>
</body>
</html>